/*!CK:3902841621!*//*1450069726,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["byxln"]); }

__d('PubcontentFeedChainingControllerX', ['AggregatedLinkComposerConfig', 'Arbiter', 'AsyncRequest', 'AttachmentRelatedShareConstants', 'ContextualThing', 'CSS', 'DOM', 'DOMQuery', 'FeedAdsChainingConfig', 'NavigationMessage', 'PageLikeConstants', 'PubcontentFeedChainingConfig', 'PubcontentRelatedShareChainingConfig', 'PubcontentTopicChainingConfig', 'RelatedEventsPivotChainingConfig', 'Run', 'SearchRelatedPostsPivotChainingConfig', 'StoryInlinePivotChainingConfig', 'StoryTopicMap', 'SubscriptionsHandler', 'UFIFeedbackTargets', 'UFIUIEvents', 'XEventRelatedEventsPivotController', 'XFeedAdsChainingController', 'XPubcontentFeedChainingController', 'XPubcontentInlineStoryPivotChainingController', 'XPubcontentRelatedShareChainingController', 'XPubcontentRelatedVideoChainingController', 'XPubcontentTopicChainingController', 'XRelatedGamesChainingController', 'XSearchRelatedPostsPivotController', 'csx', 'cx', 'getOrCreateDOMID'], function a(b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, aa, ba, ca, da, ea, fa, ga, ha, ia, ja, ka, la, ma, na, oa) { if (c.__markCompiled) c.__markCompiled(); var pa = 'ei', qa = 'ad_fan_page_action', ra = 'ad_like_page_post_action', sa = 'page_story_like_action', ta = 'related_share_article_click', ua = 'related_share_video_click', va = 'page_share_like_action', wa = 'topic_story_like_action', xa = 'story_click_for_pivot_action', ya = 'story_like_pivot_action', za = 'event_join', ab = 'composer_publish_action', bb = null, cb = false; db.init = function (eb) { 'use strict'; var fb = eb.isLazy; if (!bb) bb = new db({ isLazy: fb }); if (!cb) { w.onLeave(db.cleanup); i.subscribe(q.NAVIGATION_BEGIN, db.cleanup); cb = true; } }; db.cleanup = function () { 'use strict'; if (bb) { bb.cleanup(); bb = null; } }; function db(eb) { 'use strict'; var fb = eb.isLazy; this.$PubcontentFeedChainingControllerX1 = s; this.$PubcontentFeedChainingControllerX2 = p; this.$PubcontentFeedChainingControllerX3 = t; this.$PubcontentFeedChainingControllerX4 = u; this.$PubcontentFeedChainingControllerX5 = y; this.$PubcontentFeedChainingControllerX6 = v; this.$PubcontentFeedChainingControllerX7 = x; this.$PubcontentFeedChainingControllerX8 = {}; this.$PubcontentFeedChainingControllerX9 = new aa(); this.$PubcontentFeedChainingControllerX9.addSubscriptions(this.$PubcontentFeedChainingControllerX10(r.LIKED, fb, this.$PubcontentFeedChainingControllerX11.bind(this)), this.$PubcontentFeedChainingControllerX10(ca.ActionLinkLike, fb, this.$PubcontentFeedChainingControllerX12.bind(this)), this.$PubcontentFeedChainingControllerX10(ca.ReactionButtonClicked, fb, this.$PubcontentFeedChainingControllerX12.bind(this)), this.$PubcontentFeedChainingControllerX10('composer/publish', fb, this.$PubcontentFeedChainingControllerX13.bind(this)), this.$PubcontentFeedChainingControllerX10('LitestandComposer/publish', fb, this.$PubcontentFeedChainingControllerX13.bind(this)), this.$PubcontentFeedChainingControllerX10(k.ARTICLE_CLICK, fb, this.$PubcontentFeedChainingControllerX14.bind(this)), this.$PubcontentFeedChainingControllerX10(k.VIDEO_CLICK, fb, this.$PubcontentFeedChainingControllerX15.bind(this)), this.$PubcontentFeedChainingControllerX10(k.FBVIDEO_CLICK, fb, this.$PubcontentFeedChainingControllerX16.bind(this)), this.$PubcontentFeedChainingControllerX10(k.GAME_CLICK, fb, this.$PubcontentFeedChainingControllerX17.bind(this)), this.$PubcontentFeedChainingControllerX10(k.PHOTO_CLICK, fb, this.$PubcontentFeedChainingControllerX18.bind(this)), this.$PubcontentFeedChainingControllerX10(k.EVENT_JOIN, fb, this.$PubcontentFeedChainingControllerX19.bind(this))); } db.prototype.$PubcontentFeedChainingControllerX10 = function (event, eb, fb) { 'use strict'; var gb = eb ? [event, event + '.lazy'] : [event]; return i.subscribe(gb, fb); }; db.prototype.cleanup = function () { 'use strict'; this.$PubcontentFeedChainingControllerX9 && this.$PubcontentFeedChainingControllerX9.release(); this.$PubcontentFeedChainingControllerX9 = null; }; db.getAdClientTokenIndex = function () { 'use strict'; return pa; }; db.prototype.$PubcontentFeedChainingControllerX11 = function (eb, fb) { 'use strict'; var gb = this.findAdClientToken(fb.target); if (gb) { this.$PubcontentFeedChainingControllerX20(fb.target, { origin: qa, actor_id: fb.profile_id, client_token: gb }); } else this.$PubcontentFeedChainingControllerX21(fb.target, { origin: fb.origin, actor_id: fb.profile_id }); }; db.prototype.$PubcontentFeedChainingControllerX12 = function (eb, fb) { 'use strict'; if (!fb.ft_id || !fb.target) return; if (!this.$PubcontentFeedChainingControllerX22(this.findStory(fb.target)) || this.$PubcontentFeedChainingControllerX23(this.findStory(fb.target))) return; ba.getFeedbackTarget(fb.ft_id, (function (gb, hb) { var ib = this.findAdClientToken(gb); if (ib && hb.isshare) { this.$PubcontentFeedChainingControllerX20(gb, { actor_id: hb.actorid, origin: ra, ft_id: hb.entidentifier, client_token: ib }); } else if (hb.isownerpage) { this.$PubcontentFeedChainingControllerX21(gb, { actor_id: hb.actorid, content_id: hb.entidentifier, origin: sa }); } else if (hb.isshare) { this.$PubcontentFeedChainingControllerX21(gb, { actor_id: hb.actorid, content_id: hb.entidentifier, ft_id: hb.entidentifier, origin: va }); } else { var jb = z.getTopicsForFTID(hb.entidentifier); if (jb && jb.length > 0) { this.$PubcontentFeedChainingControllerX24(gb, { ft_id: hb.entidentifier, origin: wa, pivotal_topic_ids: jb }); } else this.$PubcontentFeedChainingControllerX25(gb, { origin: ya, ft_id: hb.entidentifier }); } }).bind(this, fb.target)); }; db.prototype.$PubcontentFeedChainingControllerX25 = function (eb, fb) { 'use strict'; var gb = this.$PubcontentFeedChainingControllerX26(eb, fb); if (!gb) return false; var hb = ga.getURIBuilder().setString('origin', fb.origin); if (fb.story_id) hb.setString('storyid', String(fb.story_id)); if (fb.ft_id) hb.setString('ftid', String(fb.ft_id)); new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, gb.story.id)).setRelativeTo(gb.chainingWrapper).setURI(hb.getURI()).setAllowCrossPageTransition(true).send(); return true; }; db.prototype.$PubcontentFeedChainingControllerX18 = function (eb, fb) { 'use strict'; var gb = this; gb.$PubcontentFeedChainingControllerX25(fb.attachment, { origin: xa, story_id: fb.storyid }); }; db.prototype.$PubcontentFeedChainingControllerX14 = function (eb, fb) { 'use strict'; if (h.no_chained_related_stories === 'true') return; fb.origin = ta; var gb = this, hb = this.findStory(fb.attachment), ib = o.scry(o.getRootElement(), '#initial_browse_result').length > 0; if (ib) return; var jb; if (fb.is_right_click) { jb = 0; } else jb = k.EVENT_DELAY; setTimeout(function () { if (hb) { var kb = gb.findAttachment(hb); if (kb) fb.attachment = kb; } gb.$PubcontentFeedChainingControllerX28(fb.attachment, fb); }, jb); }; db.prototype.$PubcontentFeedChainingControllerX15 = function (eb, fb) { 'use strict'; fb.origin = ua; var gb = this, hb = this.findStory(fb.attachment); setTimeout(function () { if (hb) { var ib = gb.findAttachment(hb); if (ib) fb.attachment = ib; } gb.$PubcontentFeedChainingControllerX28(fb.attachment, fb); }, k.EVENT_DELAY); }; db.prototype.$PubcontentFeedChainingControllerX16 = function (eb, fb) { 'use strict'; fb.origin = ua; var gb = this, hb = this.findStory(fb.attachment); setTimeout(function () { if (hb) { var ib = gb.findAttachment(hb); if (ib) fb.attachment = ib; } gb.$PubcontentFeedChainingControllerX28(fb.attachment, fb); }, k.EVENT_DELAY); }; db.prototype.$PubcontentFeedChainingControllerX17 = function (eb, fb) { 'use strict'; var gb = this, hb = this.findStory(fb.attachment); setTimeout(function () { if (hb) var ib = gb.findContainer(hb); gb.$PubcontentFeedChainingControllerX29(hb, fb.global_share_id, oa(ib)); }, k.EVENT_DELAY); }; db.prototype.$PubcontentFeedChainingControllerX19 = function (eb, fb) { 'use strict'; var gb = this.findStory(fb.attachment); if (gb) { var hb = this.findAttachment(gb); if (hb) fb.attachment = hb; } this.$PubcontentFeedChainingControllerX30(fb.attachment, { origin: za, event_id: fb.event_id }); }; db.prototype.$PubcontentFeedChainingControllerX13 = function (eb, fb) { 'use strict'; var gb = this; setTimeout(function () { gb.$PubcontentFeedChainingControllerX31(fb.markup.firstChild, { origin: ab, content_id: fb.content_id }); }, this.$PubcontentFeedChainingControllerX7.composer_publish_action); }; db.prototype.$PubcontentFeedChainingControllerX32 = function (eb) { 'use strict'; return !!(eb && eb.id && !m.hasClass(eb, "_sf6") && !(eb.id in this.$PubcontentFeedChainingControllerX8)); }; db.prototype.$PubcontentFeedChainingControllerX33 = function (eb) { 'use strict'; if (!eb) return false; if (eb.origin in this.$PubcontentFeedChainingControllerX1 || eb.origin in this.$PubcontentFeedChainingControllerX3 || eb.origin in this.$PubcontentFeedChainingControllerX2 || eb.origin in this.$PubcontentFeedChainingControllerX5 || eb.origin in this.$PubcontentFeedChainingControllerX6 || eb.origin in this.$PubcontentFeedChainingControllerX7) { return true; } else { var fb = this.$PubcontentFeedChainingControllerX4[eb.origin]; if (!fb || !fb.rate) return false; var gb = Math.random(); if (gb > fb.rate) return false; return true; } }; db.prototype.$PubcontentFeedChainingControllerX34 = function (eb) { 'use strict'; this.$PubcontentFeedChainingControllerX8[eb] = true; }; db.prototype.$PubcontentFeedChainingControllerX27 = function (eb) { 'use strict'; delete this.$PubcontentFeedChainingControllerX8[eb]; }; db.prototype.$PubcontentFeedChainingControllerX22 = function (eb) { 'use strict'; if (!eb) return false; var fb = "_3lkn", gb = eb.nextSibling, hb = true; if (gb && gb.firstChild) { var ib = gb.firstChild; hb = !(ib.hasChildNodes() && m.hasClass(ib, fb)); } if (!hb) return false; var jb = eb.children[0], kb = eb.children[1], lb = "_4_ck"; if (jb && m.hasClass(jb, lb) || kb && m.hasClass(kb, lb)) return false; return true; }; db.prototype.$PubcontentFeedChainingControllerX23 = function (eb) { 'use strict'; if (!eb) return true; var fb = n.scry(eb, "._1xwr"); if (fb.length) return true; return false; }; db.prototype.$PubcontentFeedChainingControllerX26 = function (eb, fb) { 'use strict'; var gb = this.findStory(eb); if (!this.$PubcontentFeedChainingControllerX32(gb)) return null; if (!this.$PubcontentFeedChainingControllerX33(fb)) return null; this.$PubcontentFeedChainingControllerX34(gb.id); if (this.isSponsoredStory(gb)) return null; var hb; if (!fb.continued_chaining) { hb = this.findContainer(gb); if (!hb) return null; var ib = n.create('div'), jb = n.appendContent(hb, ib); if (jb.length !== 1) return null; } else { hb = gb; ib = n.create('div'); jb = n.insertAfter(hb, ib); n.remove(hb); if (jb.length !== 1) return null; } if (fb.is_auto_expand) { return { chainingWrapper: jb[0], story: gb, is_auto_expand: fb.is_auto_expand }; } else return { chainingWrapper: jb[0], story: gb }; }; db.prototype.$PubcontentFeedChainingControllerX20 = function (eb, fb) { 'use strict'; var gb = this.$PubcontentFeedChainingControllerX26(eb, fb); if (!gb) return false; var hb = this.findStreamRoot(gb.story); if (!hb) return false; var ib = hb.getAttribute('id'), jb = ea.getURIBuilder().setString('actor_id', fb.actor_id).setString('origin', fb.origin).setString('ei', fb.client_token).setString('data_ownerid', ib); if (fb.ft_id) jb.setString('ft_id', fb.ft_id); new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, gb.story.id)).setRelativeTo(gb.chainingWrapper).setURI(jb.getURI()).send(); return true; }; db.prototype.$PubcontentFeedChainingControllerX28 = function (eb, fb) { 'use strict'; if (!this.$PubcontentFeedChainingControllerX22(this.findStory(eb))) return false; var gb = this.$PubcontentFeedChainingControllerX26(eb, fb); if (!gb) return false; m.addClass(gb.chainingWrapper, "_3lkn"); var hb = null; if (fb.fbvideo_id) { hb = ia.getURIBuilder(); hb.setInt('fbvideo_id', fb.fbvideo_id); } else { hb = ha.getURIBuilder(); hb.setInt('global_share_id', fb.global_share_id); } hb.setString('attachment_div_id', oa(fb.attachment)); if (fb.link_url) hb.setString('link_url', fb.link_url); if (fb.video_div_id) hb.setString('video_div_id', fb.video_div_id); if (fb.share_id) hb.setString('share_id', fb.share_id); var ib = JSON.parse(gb.story.getAttribute('data-ft')) || {}; if ('qid' in ib && 'mf_story_key' in ib) { hb.setString('qid', ib.qid); hb.setString('mf_story_key', ib.mf_story_key); } if (fb.is_auto_expand) { this.$PubcontentFeedChainingControllerX27(gb.story.id); hb.setBool('is_auto_expand', fb.is_auto_expand); } var jb = new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, gb.story.id)).setRelativeTo(gb.chainingWrapper).setURI(hb.getURI()); ib && jb.setData(ib); jb.send(); return true; }; db.prototype.$PubcontentFeedChainingControllerX29 = function (eb, fb, gb) { 'use strict'; if (!this.$PubcontentFeedChainingControllerX32(eb)) return null; this.$PubcontentFeedChainingControllerX34(eb.id); var hb = ka.getURIBuilder().setInt('app_id', fb).setString('attachment_div_id', gb); new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, eb.id)).setURI(hb.getURI()).send(); return true; }; db.prototype.$PubcontentFeedChainingControllerX21 = function (eb, fb) { 'use strict'; var gb = this.$PubcontentFeedChainingControllerX26(eb, fb); if (!gb) return false; var hb = fa.getURIBuilder().setString('actor_id', fb.actor_id).setString('origin', fb.origin); if (fb.ft_id) hb.setString('ft_id', fb.ft_id); if (fb.content_id) hb.setString('content_id', fb.content_id); new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, gb.story.id)).setRelativeTo(gb.chainingWrapper).setURI(hb.getURI()).send(); return true; }; db.prototype.$PubcontentFeedChainingControllerX24 = function (eb, fb) { 'use strict'; var gb = this.$PubcontentFeedChainingControllerX26(eb, fb); if (!gb) return false; var hb = ja.getURIBuilder().setIntVector('pivotal_topic_ids', fb.pivotal_topic_ids).getURI(); new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, gb.story.id)).setRelativeTo(gb.chainingWrapper).setURI(hb).send(); return true; }; db.prototype.$PubcontentFeedChainingControllerX30 = function (eb, fb) { 'use strict'; var gb = this.$PubcontentFeedChainingControllerX26(eb, fb); if (!gb) return false; var hb = da.getURIBuilder().setInt('event_id', fb.event_id).setString('attachment_id', oa(eb)).getURI(); new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, gb.story.id)).setRelativeTo(gb.chainingWrapper).setURI(hb).send(); return true; }; db.prototype.$PubcontentFeedChainingControllerX31 = function (eb, fb) { 'use strict'; var gb = this.$PubcontentFeedChainingControllerX26(eb, fb); if (!gb) return false; var hb = la.getURIBuilder().setString('origin', fb.origin).setString('content_id', String(fb.content_id)); new j().setErrorHandler(this.$PubcontentFeedChainingControllerX27.bind(this, gb.story.id)).setRelativeTo(gb.chainingWrapper).setURI(hb.getURI()).setAllowCrossPageTransition(true).send(); return true; }; db.prototype.findStory = function (eb) { 'use strict'; var fb = "^div._4-u2", gb = n.scry(eb, fb); return gb.length === 1 ? gb[0] : null; }; db.prototype.isSponsoredStory = function (eb) { 'use strict'; var fb = "._5paw"; return n.scry(eb, fb).length > 0; }; db.prototype.findAttachment = function (eb) { 'use strict'; var fb = "div._6m2", gb = "div.iframeEmbed", hb = n.scry(eb, fb)[0] || n.scry(eb, gb)[0]; return hb; }; db.prototype.findContainer = function (eb) { 'use strict'; var fb = n.create('div'), gb = n.insertAfter(eb, fb); l.register(fb, eb); return gb.length >= 1 ? gb[0] : null; }; db.prototype.findStreamRoot = function (eb) { 'use strict'; var fb = "^div._4ikz"; return n.scry(eb, fb)[0]; }; db.prototype.findAdClientToken = function (eb) { 'use strict'; var fb = this.findStory(eb); if (!fb) return null; var gb = fb.getAttribute('data-ft'); if (!gb) return null; var hb = JSON.parse(gb); return hb[db.getAdClientTokenIndex()]; }; f.exports = db; }, null);